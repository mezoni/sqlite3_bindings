import "dart:convert";
import "dart:io";

import 'package:binary_generator/library_generator/library_generator.dart';
import 'package:libc/headers.dart';
import 'package:sqlite3_bindings/headers.dart';

void main() {
  const String header = "sqlite3_bindings/tool/generate.h";
  const String name = "Sqlite3Bindings";
  var headers = <String, String>{header: _HEADER_H};
  headers.addAll(LIBC_HEADERS);
  headers.addAll(SQLITE3_HEADERS);
  var constants = new LineSplitter().convert(_CONSTANTS);
  var directives = <String>["part of sqlite3_bindings"];
  //_addImport("package:binary_interop/binary_interop.dart", directives);
  var links = SQLITE3_HEADERS.keys.toList();
  var options = new LibraryGeneratorOptions(
      constants: constants,
      directives: directives,
      header: header,
      headers: headers,
      links: links,
      name: name);
  var generator = new LibraryGenerator();
  var lines = generator.generate(options);
  var path = "lib/src/sqlite3_bindings/sqlite3_bindings_native.dart";
  var file = new File(path);
  file.createSync(recursive: true);
  file.writeAsStringSync(lines.join("\n"));
}

const String _CONSTANTS = """
SQLITE_OK
SQLITE_ERROR
SQLITE_INTERNAL
SQLITE_PERM
SQLITE_ABORT
SQLITE_BUSY
SQLITE_LOCKED
SQLITE_NOMEM
SQLITE_READONLY
SQLITE_INTERRUPT
SQLITE_IOERR
SQLITE_CORRUPT
SQLITE_NOTFOUND
SQLITE_FULL
SQLITE_CANTOPEN
SQLITE_PROTOCOL
SQLITE_EMPTY
SQLITE_SCHEMA
SQLITE_TOOBIG
SQLITE_CONSTRAINT
SQLITE_MISMATCH
SQLITE_MISUSE
SQLITE_NOLFS
SQLITE_AUTH
SQLITE_FORMAT
SQLITE_RANGE
SQLITE_NOTADB
SQLITE_NOTICE
SQLITE_WARNING
SQLITE_ROW
SQLITE_DONE
SQLITE_IOERR_READ
SQLITE_IOERR_SHORT_READ
SQLITE_IOERR_WRITE
SQLITE_IOERR_FSYNC
SQLITE_IOERR_DIR_FSYNC
SQLITE_IOERR_TRUNCATE
SQLITE_IOERR_FSTAT
SQLITE_IOERR_UNLOCK
SQLITE_IOERR_RDLOCK
SQLITE_IOERR_DELETE
SQLITE_IOERR_BLOCKED
SQLITE_IOERR_NOMEM
SQLITE_IOERR_ACCESS
SQLITE_IOERR_CHECKRESERVEDLOCK
SQLITE_IOERR_LOCK
SQLITE_IOERR_CLOSE
SQLITE_IOERR_DIR_CLOSE
SQLITE_IOERR_SHMOPEN
SQLITE_IOERR_SHMSIZE
SQLITE_IOERR_SHMLOCK
SQLITE_IOERR_SHMMAP
SQLITE_IOERR_SEEK
SQLITE_IOERR_DELETE_NOENT
SQLITE_IOERR_MMAP
SQLITE_IOERR_GETTEMPPATH
SQLITE_IOERR_CONVPATH
SQLITE_LOCKED_SHAREDCACHE
SQLITE_BUSY_RECOVERY
SQLITE_BUSY_SNAPSHOT
SQLITE_CANTOPEN_NOTEMPDIR
SQLITE_CANTOPEN_ISDIR
SQLITE_CANTOPEN_FULLPATH
SQLITE_CANTOPEN_CONVPATH
SQLITE_CORRUPT_VTAB
SQLITE_READONLY_RECOVERY
SQLITE_READONLY_CANTLOCK
SQLITE_READONLY_ROLLBACK
SQLITE_READONLY_DBMOVED
SQLITE_ABORT_ROLLBACK
SQLITE_CONSTRAINT_CHECK
SQLITE_CONSTRAINT_COMMITHOOK
SQLITE_CONSTRAINT_FOREIGNKEY
SQLITE_CONSTRAINT_FUNCTION
SQLITE_CONSTRAINT_NOTNULL
SQLITE_CONSTRAINT_PRIMARYKEY
SQLITE_CONSTRAINT_TRIGGER
SQLITE_CONSTRAINT_UNIQUE
SQLITE_CONSTRAINT_VTAB
SQLITE_CONSTRAINT_ROWID
SQLITE_NOTICE_RECOVER_WAL
SQLITE_NOTICE_RECOVER_ROLLBACK
SQLITE_WARNING_AUTOINDEX
SQLITE_AUTH_USER
SQLITE_OPEN_READONLY
SQLITE_OPEN_READWRITE
SQLITE_OPEN_CREATE
SQLITE_OPEN_DELETEONCLOSE
SQLITE_OPEN_EXCLUSIVE
SQLITE_OPEN_AUTOPROXY
SQLITE_OPEN_URI
SQLITE_OPEN_MEMORY
SQLITE_OPEN_MAIN_DB
SQLITE_OPEN_TEMP_DB
SQLITE_OPEN_TRANSIENT_DB
SQLITE_OPEN_MAIN_JOURNAL
SQLITE_OPEN_TEMP_JOURNAL
SQLITE_OPEN_SUBJOURNAL
SQLITE_OPEN_MASTER_JOURNAL
SQLITE_OPEN_NOMUTEX
SQLITE_OPEN_FULLMUTEX
SQLITE_OPEN_SHAREDCACHE
SQLITE_OPEN_PRIVATECACHE
SQLITE_OPEN_WAL
SQLITE_IOCAP_ATOMIC
SQLITE_IOCAP_ATOMIC512
SQLITE_IOCAP_ATOMIC1K
SQLITE_IOCAP_ATOMIC2K
SQLITE_IOCAP_ATOMIC4K
SQLITE_IOCAP_ATOMIC8K
SQLITE_IOCAP_ATOMIC16K
SQLITE_IOCAP_ATOMIC32K
SQLITE_IOCAP_ATOMIC64K
SQLITE_IOCAP_SAFE_APPEND
SQLITE_IOCAP_SEQUENTIAL
SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN
SQLITE_IOCAP_POWERSAFE_OVERWRITE
SQLITE_IOCAP_IMMUTABLE
SQLITE_LOCK_NONE
SQLITE_LOCK_SHARED
SQLITE_LOCK_RESERVED
SQLITE_LOCK_PENDING
SQLITE_LOCK_EXCLUSIVE
SQLITE_SYNC_NORMAL
SQLITE_SYNC_FULL
SQLITE_SYNC_DATAONLY
SQLITE_FCNTL_LOCKSTATE
SQLITE_FCNTL_GET_LOCKPROXYFILE
SQLITE_FCNTL_SET_LOCKPROXYFILE
SQLITE_FCNTL_LAST_ERRNO
SQLITE_FCNTL_SIZE_HINT
SQLITE_FCNTL_CHUNK_SIZE
SQLITE_FCNTL_FILE_POINTER
SQLITE_FCNTL_SYNC_OMITTED
SQLITE_FCNTL_WIN32_AV_RETRY
SQLITE_FCNTL_PERSIST_WAL
SQLITE_FCNTL_OVERWRITE
SQLITE_FCNTL_VFSNAME
SQLITE_FCNTL_POWERSAFE_OVERWRITE
SQLITE_FCNTL_PRAGMA
SQLITE_FCNTL_BUSYHANDLER
SQLITE_FCNTL_TEMPFILENAME
SQLITE_FCNTL_MMAP_SIZE
SQLITE_FCNTL_TRACE
SQLITE_FCNTL_HAS_MOVED
SQLITE_FCNTL_SYNC
SQLITE_FCNTL_COMMIT_PHASETWO
SQLITE_FCNTL_WIN32_SET_HANDLE
SQLITE_FCNTL_WAL_BLOCK
SQLITE_FCNTL_ZIPVFS
SQLITE_FCNTL_RBU
SQLITE_ACCESS_EXISTS
SQLITE_ACCESS_READWRITE
SQLITE_ACCESS_READ
SQLITE_SHM_UNLOCK
SQLITE_SHM_LOCK
SQLITE_SHM_SHARED
SQLITE_SHM_EXCLUSIVE
SQLITE_SHM_NLOCK
SQLITE_CONFIG_SINGLETHREAD
SQLITE_CONFIG_MULTITHREAD
SQLITE_CONFIG_SERIALIZED
SQLITE_CONFIG_MALLOC
SQLITE_CONFIG_GETMALLOC
SQLITE_CONFIG_SCRATCH
SQLITE_CONFIG_PAGECACHE
SQLITE_CONFIG_HEAP
SQLITE_CONFIG_MEMSTATUS
SQLITE_CONFIG_MUTEX
SQLITE_CONFIG_GETMUTEX
SQLITE_CONFIG_LOOKASIDE
SQLITE_CONFIG_PCACHE
SQLITE_CONFIG_GETPCACHE
SQLITE_CONFIG_LOG
SQLITE_CONFIG_URI
SQLITE_CONFIG_PCACHE2
SQLITE_CONFIG_GETPCACHE2
SQLITE_CONFIG_COVERING_INDEX_SCAN
SQLITE_CONFIG_SQLLOG
SQLITE_CONFIG_MMAP_SIZE
SQLITE_CONFIG_WIN32_HEAPSIZE
SQLITE_CONFIG_PCACHE_HDRSZ
SQLITE_CONFIG_PMASZ
SQLITE_DBCONFIG_LOOKASIDE
SQLITE_DBCONFIG_ENABLE_FKEY
SQLITE_DBCONFIG_ENABLE_TRIGGER
SQLITE_CREATE_INDEX
SQLITE_CREATE_TABLE
SQLITE_CREATE_TEMP_INDEX
SQLITE_CREATE_TEMP_TABLE
SQLITE_CREATE_TEMP_TRIGGER
SQLITE_CREATE_TEMP_VIEW
SQLITE_CREATE_TRIGGER
SQLITE_CREATE_VIEW
SQLITE_DELETE
SQLITE_DROP_INDEX
SQLITE_DROP_TABLE
SQLITE_DROP_TEMP_INDEX
SQLITE_DROP_TEMP_TABLE
SQLITE_DROP_TEMP_TRIGGER
SQLITE_DROP_TEMP_VIEW
SQLITE_DROP_TRIGGER
SQLITE_DROP_VIEW
SQLITE_INSERT
SQLITE_PRAGMA
SQLITE_READ
SQLITE_SELECT
SQLITE_TRANSACTION
SQLITE_UPDATE
SQLITE_ATTACH
SQLITE_DETACH
SQLITE_ALTER_TABLE
SQLITE_REINDEX
SQLITE_ANALYZE
SQLITE_CREATE_VTABLE
SQLITE_DROP_VTABLE
SQLITE_FUNCTION
SQLITE_SAVEPOINT
SQLITE_COPY
SQLITE_RECURSIVE
SQLITE_LIMIT_LENGTH
SQLITE_LIMIT_SQL_LENGTH
SQLITE_LIMIT_COLUMN
SQLITE_LIMIT_EXPR_DEPTH
SQLITE_LIMIT_COMPOUND_SELECT
SQLITE_LIMIT_VDBE_OP
SQLITE_LIMIT_FUNCTION_ARG
SQLITE_LIMIT_ATTACHED
SQLITE_LIMIT_LIKE_PATTERN_LENGTH
SQLITE_LIMIT_VARIABLE_NUMBER
SQLITE_LIMIT_TRIGGER_DEPTH
SQLITE_LIMIT_WORKER_THREADS
SQLITE_INTEGER
SQLITE_FLOAT
SQLITE_BLOB
SQLITE_NULL
SQLITE3_TEXT
SQLITE_UTF8
SQLITE_UTF16LE
SQLITE_UTF16BE
SQLITE_UTF16
SQLITE_ANY
SQLITE_UTF16_ALIGNED
SQLITE_DETERMINISTIC
SQLITE_STATIC
SQLITE_TRANSIENT
SQLITE_INDEX_CONSTRAINT_EQ
SQLITE_INDEX_CONSTRAINT_GT
SQLITE_INDEX_CONSTRAINT_LE
SQLITE_INDEX_CONSTRAINT_LT
SQLITE_INDEX_CONSTRAINT_GE
SQLITE_INDEX_CONSTRAINT_MATCH
SQLITE_MUTEX_FAST
SQLITE_MUTEX_RECURSIVE
SQLITE_MUTEX_STATIC_MASTER
SQLITE_MUTEX_STATIC_MEM
SQLITE_MUTEX_STATIC_MEM2
SQLITE_MUTEX_STATIC_OPEN
SQLITE_MUTEX_STATIC_PRNG
SQLITE_MUTEX_STATIC_LRU
SQLITE_MUTEX_STATIC_LRU2
SQLITE_MUTEX_STATIC_PMEM
SQLITE_MUTEX_STATIC_APP1
SQLITE_MUTEX_STATIC_APP2
SQLITE_MUTEX_STATIC_APP3
SQLITE_MUTEX_STATIC_VFS1
SQLITE_MUTEX_STATIC_VFS2
SQLITE_MUTEX_STATIC_VFS3
SQLITE_TESTCTRL_FIRST
SQLITE_TESTCTRL_PRNG_SAVE
SQLITE_TESTCTRL_PRNG_RESTORE
SQLITE_TESTCTRL_PRNG_RESET
SQLITE_TESTCTRL_BITVEC_TEST
SQLITE_TESTCTRL_FAULT_INSTALL
SQLITE_TESTCTRL_BENIGN_MALLOC_HOOKS
SQLITE_TESTCTRL_PENDING_BYTE
SQLITE_TESTCTRL_ASSERT
SQLITE_TESTCTRL_ALWAYS
SQLITE_TESTCTRL_RESERVE
SQLITE_TESTCTRL_OPTIMIZATIONS
SQLITE_TESTCTRL_ISKEYWORD
SQLITE_TESTCTRL_SCRATCHMALLOC
SQLITE_TESTCTRL_LOCALTIME_FAULT
SQLITE_TESTCTRL_EXPLAIN_STMT
SQLITE_TESTCTRL_NEVER_CORRUPT
SQLITE_TESTCTRL_VDBE_COVERAGE
SQLITE_TESTCTRL_BYTEORDER
SQLITE_TESTCTRL_ISINIT
SQLITE_TESTCTRL_SORTER_MMAP
SQLITE_TESTCTRL_IMPOSTER
SQLITE_TESTCTRL_LAST
SQLITE_STATUS_MEMORY_USED
SQLITE_STATUS_PAGECACHE_USED
SQLITE_STATUS_PAGECACHE_OVERFLOW
SQLITE_STATUS_SCRATCH_USED
SQLITE_STATUS_SCRATCH_OVERFLOW
SQLITE_STATUS_MALLOC_SIZE
SQLITE_STATUS_PARSER_STACK
SQLITE_STATUS_PAGECACHE_SIZE
SQLITE_STATUS_SCRATCH_SIZE
SQLITE_STATUS_MALLOC_COUNT
SQLITE_DBSTATUS_LOOKASIDE_USED
SQLITE_DBSTATUS_CACHE_USED
SQLITE_DBSTATUS_SCHEMA_USED
SQLITE_DBSTATUS_STMT_USED
SQLITE_DBSTATUS_LOOKASIDE_HIT
SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE
SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL
SQLITE_DBSTATUS_CACHE_HIT
SQLITE_DBSTATUS_CACHE_MISS
SQLITE_DBSTATUS_CACHE_WRITE
SQLITE_DBSTATUS_DEFERRED_FKS
SQLITE_DBSTATUS_MAX
SQLITE_STMTSTATUS_FULLSCAN_STEP
SQLITE_STMTSTATUS_SORT
SQLITE_STMTSTATUS_AUTOINDEX
SQLITE_STMTSTATUS_VM_STEP
SQLITE_CHECKPOINT_PASSIVE
SQLITE_CHECKPOINT_FULL
SQLITE_CHECKPOINT_RESTART
SQLITE_CHECKPOINT_TRUNCATE
SQLITE_VTAB_CONSTRAINT_SUPPORT
SQLITE_ROLLBACK
SQLITE_FAIL
SQLITE_REPLACE
SQLITE_SCANSTAT_NLOOP
SQLITE_SCANSTAT_NVISIT
SQLITE_SCANSTAT_EST
SQLITE_SCANSTAT_NAME
SQLITE_SCANSTAT_EXPLAIN
SQLITE_SCANSTAT_SELECTID
NOT_WITHIN
PARTLY_WITHIN
FULLY_WITHIN
""";

const String _HEADER_H = """
#include <sqlite3.h>
""";

void _addImport(String url, List directives) {
  directives.add("import \"$url\"");
}
